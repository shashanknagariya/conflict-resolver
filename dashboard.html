<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body { background: #f4f7f9; }
    .task-card { margin-bottom: 10px; }
    .completed { text-decoration: line-through; color: gray; }
    .delete-icon { color: red; cursor: pointer; }
    .delete-icon:hover { color: darkred; }
  </style>
</head>
<body class="container py-4">

  <h2 class="mb-4">Welcome, {{ session['username'] }}</h2>

  <!-- Task List -->
  <div class="card p-3 shadow-sm">
    <h5 class="mb-3">Tasks</h5>
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Status</th>
          <th>Task</th>
          <th>Points</th>
          <th>Assigned To</th>
          <th>Type</th>
          <th>Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for task in tasks %}
        <tr id="task-{{ loop.index }}">
          <td>
            <input type="checkbox" class="form-check-input" 
                   {% if task.status == 'completed' %}checked{% endif %} 
                   onchange="updateStatus('{{ loop.index }}', this.checked)">
          </td>
          <td class="{% if task.status == 'completed' %}completed{% endif %}">{{ task.name }}</td>
          <td>{{ task.points }}</td>
          <td>{{ task.assigned_to }}</td>
          <td>{{ task.type }}</td>
          <td>
            <i class="fa fa-trash delete-icon" onclick="deleteTask('{{ loop.index }}')"></i>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <a href="{{ url_for('create_task') }}" class="btn btn-primary mt-3">+ Add Task</a>
  <a href="{{ url_for('status') }}" class="btn btn-secondary mt-3">View Status</a>
  <a href="{{ url_for('logout') }}" class="btn btn-danger mt-3">Logout</a>

  <script>
    function updateStatus(taskId, completed) {
      fetch(`/update_status/${taskId}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({status: completed ? "completed" : "pending"})
      }).then(res => location.reload());
    }

    function deleteTask(taskId) {
      if(confirm("Are you sure you want to delete this task?")) {
        fetch(`/delete/${taskId}`, { method: "POST" })
          .then(res => location.reload());
      }
    }
  </script>
</body>
</html>
